#-------------------------------------------------------------------------------
# File Name:    do.R
# Author(s):    Reuben Bauer
# Written:      12/13/2016
#
# Inputs:
#
# Outputs:
#
# Description:
#
#	1. Set repository
#	2. Clear workspace
# 	3. Load libaries
#	4. Source functions
#	5. Run project
#
#-------------------------------------------------------------------------------
#---------------------------- Section 1: Preliminaries -------------------------
#-------- set repository ----
#repository <- "C:/Users/reubenbauer/Documents/Github/cpd_stops/"
repository <- "C:/Users/reuben_bauer/Documents/Github/cpd_stops/"
setwd(repository)
#-------- clear workspave ---
rm(list = ls())
gc()
#-------- load libaries -----
library(reshape2)
library(ggplot2)
library(dplyr)
library(data.table)
library(doBy)
library(zoo)
source("load.R")
names(data)[names(data) == "Primary Type"]<-"crime_type"
narcotics <- filter(data, crime_type == "NARCOTICS")
narcotics$Date <- as.Date(narcotics$Date, "%m/%d/%Y %H:%M:%S")
narcotics$Month <- as.yearmon(narcotics$Date)
narcotics <- filter(narcotics, Month != "Aug 2016")
#combine small drug categories
narcotics$Description[narcotics$Description == "POSS: HALLUCINOGENS" |
narcotics$Description == "POSS: HEROIN(BLACK TAR)" |
narcotics$Description == "POSS: LOOK-ALIKE DRUGS" |
narcotics$Description == "POSS: METHAMPHETAMINES" |
narcotics$Description == "POS: HYPODERMIC NEEDLE" |
narcotics$Description == "POSS: AMPHETAMINES" |
narcotics$Description == "POSS: SYNTHETIC DRUGS" |
narcotics$Description == "POSS: PCP" |
narcotics$Description == "POSS: BARBITUATES" |
narcotics$Description == "POSS: CANNABIS MORE THAN 30GMS" |
narcotics$Description == "POSS: HEROIN(BRN/TAN)"
]<-"POSS: OTHER"
narcotics_count <- count(narcotics, c("crime_type", "Month"))
?count
library(dplyr)
narcotics_count <- count(narcotics, c("crime_type", "Month"))
narcotics_count <- count(narcotics, c("crime_type", "Month"))
library(dplyr)
narcotics_count <- count(narcotics, c("crime_type", "Month"))
library(data.table)
narcotics_count <- count(narcotics, c("crime_type", "Month"))
?count
?count
library(doBy)
library(zoo)
?count
library(reshape2)
library(ggplot2)
library(dplyr)
library(data.table)
library(doBy)
library(zoo)
?count
library(plyr)
narcotics_count <- count(narcotics, c("crime_type", "Month"))
#-------------------------------------------------------------------------------
# File Name:    do.R
# Author(s):    Reuben Bauer
# Written:      12/13/2016
#
# Inputs:
#
# Outputs:
#
# Description:
#
#	1. Set repository
#	2. Clear workspace
# 	3. Load libaries
#	4. Source functions
#	5. Run project
#
#-------------------------------------------------------------------------------
#---------------------------- Section 1: Preliminaries -------------------------
#-------- set repository ----
#repository <- "C:/Users/reubenbauer/Documents/Github/cpd_stops/"
repository <- "C:/Users/reuben_bauer/Documents/Github/cpd_stops/"
setwd(repository)
#-------- clear workspave ---
rm(list = ls())
gc()
#-------- load libaries -----
library(reshape2)
library(ggplot2)
library(dplyr)
library(data.table)
library(doBy)
library(zoo)
library(plyr)
#-------- source functions --
source("func.R")
#---------------------------- Section 2: Run Project ---------------------------
source("load.R")
source("clean.R")
source("graph.R")
print("KLAAR")
multiplot(plot1, plot2, plot3, cols=3)
library(ggplot2)
multiplot(plot1, plot2, cols=2)
#-------------------------------------------------------------------------------
# File Name:    load.R
# Author(s):    Reuben Bauer
# Written:      12/13/2016
#
# Inputs:       Crimes_-_2001_to_present type(csv)
#
# Outputs:      data type(dataframe)
#
# Description:
#
# 	1. Load the criminal records data from the CPD into R.
#
#-------------------------------------------------------------------------------
#---------------------------- Section 1: Preliminaries -------------------------
#-------- set repository ----
data_repository <- "C:/Users/reubenbauer/Box Sync/cpd_stops/data/"
data_repository <- "C:/Users/reuben_bauer/Box Sync/Box Sync/cpd_stops/data/"
#---------------------------- Section 2: Load Data -----------------------------
data = fread(paste0(data_repository,
"Crimes_-_2001_to_present.csv"), header = TRUE, stringsAsFactors = FALSE)
#-------------------------------------------------------------------------------
# File Name:    do.R
# Author(s):    Reuben Bauer
# Written:      12/13/2016
#
# Inputs:
#
# Outputs:
#
# Description:
#
#	1. Clear workspace
#	2. Set repository
# 	3. Load libaries
#	4. Source functions
#	5. Run project
#
#-------------------------------------------------------------------------------
#---------------------------- Section 1: Preliminaries -------------------------
#-------- clear workspave ---
rm(list = ls())
gc()
#-------- set repository ----
#repository <- "C:/Users/reubenbauer/Documents/Github/cpd_stops/"
repository <- "C:/Users/reuben_bauer/Documents/Github/cpd_stops/"
setwd(repository)
#-------- load libaries -----
library(reshape2)
library(ggplot2)
library(dplyr)
library(data.table)
library(doBy)
library(zoo)
library(plyr)
#-------- source functions --
source("func.R")
source('~/GitHub/cpd_stops/load.R', echo=TRUE)
names(data)[names(data) == "Primary Type"]<-"crime_type"
narcotics <- filter(data, crime_type == "NARCOTICS")
narcotics$Date <- as.Date(narcotics$Date, "%m/%d/%Y %H:%M:%S")
narcotics$Month <- as.yearmon(narcotics$Date)
narcotics <- filter(narcotics, Month != "Aug 2016")
#combine small drug categories
narcotics$Description[narcotics$Description == "POSS: HALLUCINOGENS" |
narcotics$Description == "POSS: HEROIN(BLACK TAR)" |
narcotics$Description == "POSS: LOOK-ALIKE DRUGS" |
narcotics$Description == "POSS: METHAMPHETAMINES" |
narcotics$Description == "POS: HYPODERMIC NEEDLE" |
narcotics$Description == "POSS: AMPHETAMINES" |
narcotics$Description == "POSS: SYNTHETIC DRUGS" |
narcotics$Description == "POSS: PCP" |
narcotics$Description == "POSS: BARBITUATES" |
narcotics$Description == "POSS: CANNABIS MORE THAN 30GMS" |
narcotics$Description == "POSS: HEROIN(BRN/TAN)"
]<-"POSS: OTHER"
#-------- gen narcotics count -
narcotics_count <- count(narcotics, c("crime_type", "Month"))
#-------- gen narcotics descriptioncount -
narc_sub_count <- count(narcotics, c("crime_type", "Description", "Month"))
narc_sub_count <- filter(narc_sub_count,
Description != "CALCULATED CANNABIS CONSPIRACY" &
Description != "CANNABIS PLANT" &
Description != "CONT SUBS:FAIL TO MAINT RECORD" &
Description != "CRIMINAL DRUG CONSPIRACY" &
Description != "DEL CONT SUBS TO PERSON <18" &
Description != "DELIVER CANNABIS TO PERSON <18" &
Description != "FAIL REGISTER LIC:CONT SUBS" &
Description != "FAILURE TO KEEP HYPO RECORDS" &
Description != "MANU/DELIVER: HALLUCINOGEN" &
Description != "MANU/DELIVER: HEROIN(BRN/TAN)" &
Description != "MANU/DELIVER: METHAMPHETAMINES" &
Description != "MANU/DELIVER:AMPHETAMINES" &
Description != "MANU/DELIVER:BARBITUATES" &
Description != "MANU/DELIVER:HEROIN(BLACK TAR)" &
Description != "MANU/DELIVER:LOOK-ALIKE DRUG" &
Description != "MANU/DELIVER:PCP" &
Description != "MANU/DELIVER:SYNTHETIC DRUGS" &
Description != "MANU/POSS. W/INTENT TO DELIVER: SYNTHETIC MARIJUANA" &
Description != "POSSESSION: SYNTHETIC MARIJUANA" &
Description != "SALE/DEL DRUG PARAPHERNALIA" &
Description != "SALE/DEL HYPODERMIC NEEDLE" &
Description != "ALTER/FORGE PRESCRIPTION" &
Description != "ATTEMPT POSSESSION CANNABIS" &
Description != "ATTEMPT POSSESSION NARCOTICS" &
Description != "FORFEIT PROPERTY" &
Description != "FOUND SUSPECT NARCOTICS" &
Description != "MANU/DEL:CANNABIS 10GM OR LESS" &
Description != "MANU/DEL:CANNABIS OVER 10 GMS" &
Description != "MANU/DELIVER: HEROIN (WHITE)" &
Description != "MANU/DELIVER:COCAINE" &
Description != "MANU/DELIVER:CRACK" &
Description != "POSSESSION OF DRUG EQUIPMENT" &
#Description != "POSS: CANNABIS 30GMS OR LESS" &
#Description != "POSS: COCAINE" &
#Description != "POSS: CRACK" &
#Description != "POSS: HEROIN(BRN/TAN)" &
#Description != "POSS: HEROIN(WHITE)" &
#Description != "POSS: Other" &
Description != "SOLICIT NARCOTICS ON PUBLICWAY")
narc_sub_count$quarter <-
as.yearqtr(narc_sub_count$Month, format = "%Y-%m-%d")
narc_sub_count_qrtly <- ddply(narc_sub_count,
.(crime_type, Description, quarter), summarize, Sum=sum(freq))
narc_sub_count_qrtly <- filter(narc_sub_count_qrtly, quarter != "2016 Q3")
}
#-------------------------------------------------------------------------------
# File Name:    func.R
# Author(s):    Reuben Bauer
# Written:      12/13/2016
#
# Inputs:
#
# Outputs:
#
# Description:
#
# 1.
#
#
#-------------------------------------------------------------------------------
#---------------------------- Section 1: Define Functions ----------------------
#-------- Define multiplot --
# Multiple plot function
#
# ggplot objects can be passed in ..., or to plotlist (as a list of ggplot objects)
# - cols:   Number of columns in layout
# - layout: A matrix specifying the layout. If present, 'cols' is ignored.
#
# If the layout is something like matrix(c(1,2,3,3), nrow=2, byrow=TRUE),
# then plot 1 will go in the upper left, 2 will go in the upper right, and
# 3 will go all the way across the bottom.
#
multiplot <- function(..., plotlist=NULL, file, cols=1, layout=NULL) {
library(grid)
# Make a list from the ... arguments and plotlist
plots <- c(list(...), plotlist)
numPlots = length(plots)
# If layout is NULL, then use 'cols' to determine layout
if (is.null(layout)) {
# Make the panel
# ncol: Number of columns of plots
# nrow: Number of rows needed, calculated from # of cols
layout <- matrix(seq(1, cols * ceiling(numPlots/cols)),
ncol = cols, nrow = ceiling(numPlots/cols))
}
if (numPlots==1) {
print(plots[[1]])
} else {
# Set up the page
grid.newpage()
pushViewport(viewport(layout = grid.layout(nrow(layout), ncol(layout))))
# Make each plot, in the correct location
for (i in 1:numPlots) {
# Get the i,j matrix positions of the regions that contain this subplot
matchidx <- as.data.frame(which(layout == i, arr.ind = TRUE))
print(plots[[i]], vp = viewport(layout.pos.row = matchidx$row,
layout.pos.col = matchidx$col))
}
}
}
plot1 <- ggplot(data=narcotics_count, aes(x=Month, y=freq)) +
geom_line() + geom_point()
plot1
plot2 <- ggplot(data=narc_sub_count, aes(x=Month, y=freq, colour = Description)) +
geom_line() + geom_point() + scale_x_continuous(breaks = 2001:2016)
plot2''
plot2
plot3 <- ggplot(data=narc_sub_count_qrtly, aes(x=quarter, y=Sum, colour = Description)) +
geom_line() + geom_point() + scale_x_continuous(breaks = 2001:2016)
plot3
plot4 <- multiplot(plot1, plot2, plot3, cols=3)
setwd(paste0(repository, "output/"))
ggsave(plot4, "graphs.pdf")
setwd(paste0(repository, "output/"))
ggsave("graphs.pdf")
ggsave("graphs.pdf", plot = plot4)
ggsave("graphs.pdf", plot = plot4)
plot4 <- multiplot(plot1, plot2, plot3, cols=3)
setwd(paste0(repository, "output/"))
jpeg(filename = "graphs.pdf", pointsize =12, quality = 200, bg = "white", res = NA, restoreConsole = TRUE)
multiplot(plot1, plot2, plot3, cols=3)
dev.off()
dev.of()
dev.off()
dev.off()
setwd(paste0(repository, "output/"))
jpeg(filename = "graphs.jpeg", pointsize =12, quality = 200, bg = "white", res = NA, restoreConsole = TRUE)
multiplot(plot1, plot2, plot3, cols=3)
dev.off()
setwd(paste0(repository, "output/"))
jpeg(filename = "graphs.jpeg", pointsize =12, quality = 200, bg = "white", res = NA, restoreConsole = TRUE)
multiplot(plot1, plot2, plot3, cols=3)
dev.off()
setwd(paste0(repository, "output/"))
jpeg(filename = "graphs.pdf", pointsize =12, quality = 200, bg = "white", res = NA, restoreConsole = TRUE)
multiplot(plot1, plot2, plot3, cols=3)
dev.off()
setwd(paste0(repository, "output/"))
pdf(filename = "graphs.pdf", pointsize =12, quality = 200, bg = "white", res = NA, restoreConsole = TRUE)
multiplot(plot1, plot2, plot3, cols=3)
dev.off()
setwd(paste0(repository, "output/"))
pdf(filename = "graphs.pdf")
multiplot(plot1, plot2, plot3, cols=3)
dev.off()
setwd(paste0(repository, "output/"))
png(filename = "graphs.png")
multiplot(plot1, plot2, plot3, cols=3)
dev.off()
plot2 <- ggplot(data=narc_sub_count, aes(x=Month, y=freq, colour = Description)) +
geom_line() + geom_point() + scale_x_continuous(breaks = 2001:2016) + theme(legend.position="none")
#-------- graph narcotic subgroups by quarter -
plot3 <- ggplot(data=narc_sub_count_qrtly, aes(x=quarter, y=Sum, colour = Description)) +
geom_line() + geom_point() + scale_x_continuous(breaks = 2001:2016) + theme(legend.position="none")
plot2
plot3
multiplot(plot1, plot2, plot3, cols=3)
plot1 <- ggplot(data=narcotics_count, aes(x=Month, y=freq)) +
geom_line() + geom_point() + scale_x_continuous(breaks = 2001:2016)
#-------- graph narcotic subgroups by month -
plot2 <- ggplot(data=narc_sub_count, aes(x=Month, y=freq, colour = Description)) +
geom_line() + geom_point() + scale_x_continuous(breaks = 2001:2016) + theme(legend.position="none")
#-------- graph narcotic subgroups by quarter -
plot3 <- ggplot(data=narc_sub_count_qrtly, aes(x=quarter, y=Sum, colour = Description)) +
geom_line() + geom_point() + scale_x_continuous(breaks = 2001:2016) + theme(legend.position="none")
multiplot(plot1, plot2, plot3, cols=3)
setwd(paste0(repository, "output/"))
pdf(filename = "graphs.pdf")
multiplot(plot1, plot2, plot3, cols=3)
dev.off()
setwd(paste0(repository, "output/"))
pdf(filename = "multiplot.pdf")
multiplot(plot1, plot2, plot3, cols=3)
dev.off()
getwd()
pdf("multiplot.pdf")
multiplot(plot1, plot2, plot3, cols=3)
dev.off()
plot1
plot1 <- ggplot(data=narcotics_count, aes(x=Month, y=freq)) +
geom_line() + geom_point() + scale_x_continuous(breaks = 2001:2016)
ggsave("monthly_narcotics.pdf", plot = plot4)
#-------- graph narcotic subgroups by month -
plot2 <- ggplot(data=narc_sub_count, aes(x=Month, y=freq, colour = Description)) +
geom_line() + geom_point() + scale_x_continuous(breaks = 2001:2016) + theme(legend.position="none")
ggsave("monthly_narcotics_sub.pdf", plot = plot4)
#-------- graph narcotic subgroups by quarter -
plot3 <- ggplot(data=narc_sub_count_qrtly, aes(x=quarter, y=Sum, colour = Description)) +
geom_line() + geom_point() + scale_x_continuous(breaks = 2001:2016) + theme(legend.position="none")
ggsave("quarterly_narcotics.pdf", plot = plot4)
dev.off()
dev.off()
plot1 <- ggplot(data=narcotics_count, aes(x=Month, y=freq)) +
geom_line() + geom_point() + scale_x_continuous(breaks = 2001:2016)
ggsave("monthly_narcotics.pdf", plot = plot4)
#-------- graph narcotic subgroups by month -
plot2 <- ggplot(data=narc_sub_count, aes(x=Month, y=freq, colour = Description)) +
geom_line() + geom_point() + scale_x_continuous(breaks = 2001:2016) + theme(legend.position="none")
ggsave("monthly_narcotics_sub.pdf", plot = plot4)
#-------- graph narcotic subgroups by quarter -
plot3 <- ggplot(data=narc_sub_count_qrtly, aes(x=quarter, y=Sum, colour = Description)) +
geom_line() + geom_point() + scale_x_continuous(breaks = 2001:2016) + theme(legend.position="none")
ggsave("quarterly_narcotics.pdf", plot = plot4)
rm(plot4)
plot1 <- ggplot(data=narcotics_count, aes(x=Month, y=freq)) +
geom_line() + geom_point() + scale_x_continuous(breaks = 2001:2016)
ggsave("monthly_narcotics.pdf", plot = plot1)
#-------- graph narcotic subgroups by month -
plot2 <- ggplot(data=narc_sub_count, aes(x=Month, y=freq, colour = Description)) +
geom_line() + geom_point() + scale_x_continuous(breaks = 2001:2016) + theme(legend.position="none")
ggsave("monthly_narcotics_sub.pdf", plot = plot2)
#-------- graph narcotic subgroups by quarter -
plot3 <- ggplot(data=narc_sub_count_qrtly, aes(x=quarter, y=Sum, colour = Description)) +
geom_line() + geom_point() + scale_x_continuous(breaks = 2001:2016) + theme(legend.position="none")
ggsave("quarterly_narcotics.pdf", plot = plot3)
#-------- graph narcotic subgroups by quarter -
plot3 <- ggplot(data=narc_sub_count_qrtly, aes(x=quarter, y=Sum, colour = Description)) +
geom_line() + geom_point() + scale_x_continuous(breaks = 2001:2016) + theme(legend.position="none")
ggsave("quarterly_narcotics_sub.pdf", plot = plot3)
